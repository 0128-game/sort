<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>The Absolute Sorting Encyclopedia - Controlled</title>
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; --card: #ffffff; --text: #0f172a; --success: #2ecc71; }
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 95vw; max-width: 1100px; }
        .controls { background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
        .graph-container { background: #1e293b; height: 300px; border-radius: 8px; display: flex; align-items: flex-end; padding: 10px; gap: 1px; margin-bottom: 20px; }
        .bar { background: #38bdf8; flex: 1; height: 0%; }
        .bar.comparing { background: #ef4444 !important; }
        .bar.writing { background: #fbbf24 !important; }
        .bar.finished { background: var(--success) !important; transition: background 0.05s; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 15px; }
        .stat-card { background: var(--card); padding: 15px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); border-top: 4px solid var(--primary); }
        .label { font-size: 0.75rem; color: #64748b; font-weight: bold; text-transform: uppercase; margin-bottom: 5px; }
        .value { font-size: 0.9rem; line-height: 1.5; font-weight: 500; }
        select, input, button { padding: 10px; border-radius: 6px; border: 1px solid #cbd5e1; font-size: 0.9rem; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        button:hover { background: #1d4ed8; }
        button:disabled { background: #cbd5e1; }
    </style>
</head>
<body>

<div class="container">
    <h2>ã‚½ãƒ¼ãƒˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ç©¶æ¥µå›³é‘‘ (åœæ­¢ãƒ»å›ºå®šç²›æ¸…ç‰ˆ)</h2>

    <div class="controls">
        <div>
            <div class="label">ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </div>
            <select id="algoSelect" style="width: 100%;" onchange="updateInfo()">
                <optgroup label="ğŸš€ é«˜é€Ÿã‚½ãƒ¼ãƒˆ">
                    <option value="quick">ã‚¯ã‚¤ãƒƒã‚¯ã‚½ãƒ¼ãƒˆ</option>
                    <option value="heap">ãƒ’ãƒ¼ãƒ—ã‚½ãƒ¼ãƒˆ</option>
                    <option value="shell">ã‚·ã‚§ãƒ«ã‚½ãƒ¼ãƒˆ</option>
                </optgroup>
                <optgroup label="ğŸ” åŸºæœ¬ã‚½ãƒ¼ãƒˆ">
                    <option value="insertion">æŒ¿å…¥ã‚½ãƒ¼ãƒˆ</option>
                    <option value="selection">é¸æŠã‚½ãƒ¼ãƒˆ</option>
                    <option value="bubble">ãƒãƒ–ãƒ«ã‚½ãƒ¼ãƒˆ</option>
                    <option value="cocktail">ã‚«ã‚¯ãƒ†ãƒ«ã‚½ãƒ¼ãƒˆ</option>
                </optgroup>
                <optgroup label="ğŸ¤¡ ãƒã‚¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³">
                    <option value="abe">ã‚¢ãƒ™ã‚½ãƒ¼ãƒˆ (ä¸Šæ–¹ä¿®æ­£)</option>
                    <option value="stalin">ã‚¹ã‚¿ãƒ¼ãƒªãƒ³ã‚½ãƒ¼ãƒˆ (å›ºå®šç²›æ¸…)</option>
                    <option value="bogo">ãƒœã‚´ã‚½ãƒ¼ãƒˆ (ç¥é ¼ã¿)</option>
                    <option value="miracle">ãƒŸãƒ©ã‚¯ãƒ«ã‚½ãƒ¼ãƒˆ (å¥‡è·¡å¾…ã¡)</option>
                </optgroup>
            </select>
        </div>
        <div>
            <div class="label">ãƒ‡ãƒ¼ã‚¿æ•° (5ã€œ300)</div>
            <input type="number" id="dataCount" value="60" min="5" max="300" style="width: 80%;">
        </div>
        <div style="display: flex; align-items: flex-end; gap: 10px;">
            <button onclick="resetAll()" style="background: #64748b;">ãƒªã‚»ãƒƒãƒˆ</button>
            <button onclick="startSort()" id="startBtn">ã‚½ãƒ¼ãƒˆé–‹å§‹</button>
        </div>
    </div>

    <div class="graph-container" id="graph"></div>

    <div class="stats-grid">
        <div class="stat-card"><div class="label">ä»•çµ„ã¿</div><div class="value" id="logicText">-</div></div>
        <div class="stat-card"><div class="label">è¨ˆç®—æ™‚é–“ (æœ€è‰¯ / æœ€æ‚ª)</div><div class="value" id="complexityText">-</div></div>
        <div class="stat-card"><div class="label">è¨ˆæ¸¬çµæœ</div><div class="value" id="timeValue">0.000 ç§’ (0.00 ms)</div></div>
    </div>
</div>

<script>
    let array = [];
    let isSorting = false; // ã‚½ãƒ¼ãƒˆä¸­ãƒ•ãƒ©ã‚°
    const graph = document.getElementById('graph');

    const info = {
        quick: { logic: "ãƒ”ãƒœãƒƒãƒˆã‚’åŸºæº–ã«å…¥ã‚Œæ›¿ãˆã‚’è¡Œã„ã€ç¯„å›²ã‚’åˆ†å‰²ã—ã¦å†å¸°ã—ã¾ã™ã€‚", comp: "O(n log n) / O(nÂ²)" },
        heap: { logic: "é…åˆ—ã‚’ãƒ’ãƒ¼ãƒ—æ§‹é€ ã«è¦‹ç«‹ã¦ã¦ã€æœ€å¤§å€¤ã¨æœ«å°¾ã‚’å…¥ã‚Œæ›¿ãˆç¶šã‘ã¾ã™ã€‚", comp: "O(n log n) / O(n log n)" },
        shell: { logic: "ä¸€å®šé–“éš”ã”ã¨ã®è¦ç´ ã‚’æ¯”è¼ƒã—ã€å¾ã€…ã«é–“éš”ã‚’è©°ã‚æ•´åˆ—ã•ã›ã¾ã™ã€‚", comp: "O(n log n) / O(nÂ².Â²âµã€œ)" },
        insertion: { logic: "å€¤ã‚’ä¸€ã¤ãšã¤å–ã‚Šå‡ºã—ã€æ•´åˆ—æ¸ˆã¿ã®ç¯„å›²ã¸ç›´æ¥å·®ã—è¾¼ã¿ã¾ã™ã€‚", comp: "O(n) / O(nÂ²)" },
        selection: { logic: "æœ€å°å€¤ã‚’æ¢ã—å‡ºã—ã€æœªæ•´åˆ—ç¯„å›²ã®å…ˆé ­ã¨å…¥ã‚Œæ›¿ãˆã¾ã™ã€‚", comp: "O(nÂ²) / O(nÂ²)" },
        bubble: { logic: "éš£ã‚Šåˆã†è¦ç´ ã‚’æ¯”è¼ƒã—ã€é€†é †ãªã‚‰å…¥ã‚Œæ›¿ãˆã¾ã™ã€‚", comp: "O(n) / O(nÂ²)" },
        cocktail: { logic: "ãƒãƒ–ãƒ«ã‚½ãƒ¼ãƒˆã‚’å¾€å¾©ã•ã›ã€å·¦å³ã‚’è©°ã‚ãªãŒã‚‰æ•´åˆ—ã—ã¾ã™ã€‚", comp: "O(n) / O(nÂ²)" },
        abe: { logic: "ç¾åœ¨ã®æœ€å¤§å€¤ã‚’ä¸‹å›ã‚‹è¦ç´ ã‚’ã€ãã®å ´ã§æœ€å¤§å€¤ã«æ›¸ãæ›ãˆã¾ã™ã€‚", comp: "O(n) / O(n)" },
        stalin: { logic: "é †åºã‚’ä¹±ã™è¦ç´ ã‚’ã€ãã®å ´ã§0ï¼ˆæ¶ˆå»ï¼‰ã«æ›¸ãæ›ãˆã¾ã™ã€‚ä½ç½®ã¯å›ºå®šã§ã™ã€‚", comp: "O(n) / O(n)" },
        bogo: { logic: "æƒã†ã¾ã§é…åˆ—å…¨ä½“ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«å…¥ã‚Œæ›¿ãˆç¶šã‘ã¾ã™ã€‚", comp: "O(n) / âˆ" },
        miracle: { logic: "ä½•ã‚‚ã›ãšã€ç‰©ç†ç¾è±¡ã«ã‚ˆã‚‹ãƒ¡ãƒ¢ãƒªæ›¸ãæ›ãˆã‚’å¾…ã¡ã¾ã™ã€‚", comp: "O(n) / âˆ" }
    };

    function render(hl = [], type = 'comparing') {
        graph.innerHTML = '';
        array.forEach((v, i) => {
            const b = document.createElement('div');
            b.className = 'bar';
            b.style.height = `${v}%`;
            if (hl.includes(i)) b.classList.add(type);
            graph.appendChild(b);
        });
    }

    function resetAll() {
        isSorting = false; // ãƒ«ãƒ¼ãƒ—åœæ­¢
        const count = parseInt(document.getElementById('dataCount').value);
        array = Array.from({length: count}, () => Math.floor(Math.random() * 90) + 10);
        render();
        document.getElementById('timeValue').innerText = "0.000 ç§’ (0.00 ms)";
        document.getElementById('startBtn').disabled = false;
    }

    const sleep = (ms) => new Promise(r => setTimeout(r, ms));

    async function checkStop() {
        if (!isSorting) throw new Error("STOP");
        await sleep(10); // å…±é€šã®å¾…æ©Ÿæ™‚é–“
    }

    async function finishEffect() {
        const bars = document.getElementsByClassName('bar');
        for (let i = 0; i < bars.length; i++) {
            if (!isSorting) return;
            bars[i].classList.add('finished');
            await sleep(15);
        }
    }

    async function startSort() {
        const btn = document.getElementById('startBtn');
        btn.disabled = true;
        isSorting = true;
        const a = document.getElementById('algoSelect').value;
        const start = performance.now();
        
        try {
            if (a === 'quick') await quickSort(0, array.length - 1);
            else if (a === 'heap') await heapSort();
            else if (a === 'shell') await shellSort();
            else if (a === 'insertion') await insertionSort();
            else if (a === 'selection') await selectionSort();
            else if (a === 'bubble') await bubbleSort();
            else if (a === 'cocktail') await cocktailSort();
            else if (a === 'abe') await abeSort();
            else if (a === 'stalin') await stalinSort();
            else if (a === 'bogo') await bogoSort();
            else if (a === 'miracle') await miracleSort();

            const end = performance.now();
            const diff = end - start;
            document.getElementById('timeValue').innerText = `${(diff / 1000).toFixed(3)} ç§’ (${diff.toFixed(2)} ms)`;
            
            render();
            await finishEffect();
        } catch (e) {
            if (e.message !== "STOP") console.error(e);
        } finally {
            btn.disabled = false;
            isSorting = false;
        }
    }

    // --- ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å®Ÿè£…ï¼ˆåœæ­¢ãƒã‚§ãƒƒã‚¯å…¥ã‚Šï¼‰ ---
    async function quickSort(s, e) {
        if (s >= e) return;
        let p = array[e], i = s;
        for (let j = s; j < e; j++) {
            await checkStop();
            if (array[j] < p) { [array[i], array[j]] = [array[j], array[i]]; i++; render([i, j]); }
        }
        [array[i], array[e]] = [array[e], array[i]];
        await quickSort(s, i - 1); await quickSort(i + 1, e);
    }

    async function heapSort() {
        let n = array.length;
        const heapify = async (size, idx) => {
            let largest = idx, l = 2*idx+1, r = 2*idx+2;
            if (l < size && array[l] > array[largest]) largest = l;
            if (r < size && array[r] > array[largest]) largest = r;
            if (largest !== idx) { 
                await checkStop();
                [array[idx], array[largest]] = [array[largest], array[idx]]; 
                render([idx, largest]); await heapify(size, largest); 
            }
        };
        for (let i = Math.floor(n/2)-1; i >= 0; i--) await heapify(n, i);
        for (let i = n-1; i > 0; i--) { 
            await checkStop();
            [array[0], array[i]] = [array[i], array[0]]; render([i]); await heapify(i, 0); 
        }
    }

    async function shellSort() {
        for (let gap = Math.floor(array.length/2); gap > 0; gap = Math.floor(gap/2)) {
            for (let i = gap; i < array.length; i++) {
                let temp = array[i], j = i;
                while (j >= gap && array[j-gap] > temp) { 
                    await checkStop();
                    array[j] = array[j-gap]; j -= gap; render([j], 'writing'); 
                }
                array[j] = temp;
            }
        }
    }

    async function stalinSort() {
        let max = array[0];
        for (let i = 1; i < array.length; i++) {
            await checkStop();
            if (array[i] < max) {
                array[i] = 0; // ç²›æ¸…ï¼šãã®å ´ã‚’0ã«ã™ã‚‹ï¼ˆå·¦è©°ã‚ã—ãªã„ï¼‰
            } else {
                max = array[i];
            }
            render([i], 'comparing');
        }
    }

    async function abeSort() {
        let max = array[0];
        for (let i = 1; i < array.length; i++) {
            await checkStop();
            if (array[i] < max) array[i] = max; else max = array[i];
            render([i], 'writing');
        }
    }

    async function insertionSort() {
        for (let i = 1; i < array.length; i++) {
            let key = array[i], j = i - 1;
            while (j >= 0 && array[j] > key) { 
                await checkStop();
                array[j+1] = array[j]; j--; render([j, i], 'writing'); 
            }
            array[j+1] = key;
        }
    }

    async function selectionSort() {
        for (let i = 0; i < array.length; i++) {
            let m = i;
            for (let j = i + 1; j < array.length; j++) { 
                await checkStop();
                if (array[j] < array[m]) m = j; render([i, j]); 
            }
            [array[i], array[m]] = [array[m], array[i]];
        }
    }

    async function bubbleSort() {
        for (let i = 0; i < array.length; i++) {
            for (let j = 0; j < array.length - i - 1; j++) {
                await checkStop();
                if (array[j] > array[j+1]) [array[j], array[j+1]] = [array[j+1], array[j]];
                render([j, j+1]);
            }
        }
    }

    async function cocktailSort() {
        let l = 0, r = array.length - 1;
        while (l < r) {
            for (let i = l; i < r; i++) { await checkStop(); if (array[i] > array[i+1]) [array[i], array[i+1]] = [array[i+1], array[i]]; render([i, i+1]); }
            r--;
            for (let i = r; i > l; i--) { await checkStop(); if (array[i] < array[i-1]) [array[i], array[i-1]] = [array[i-1], array[i]]; render([i, i-1]); }
            l++;
        }
    }

    async function bogoSort() {
        const isS = () => array.every((v, i) => i === 0 || v >= array[i-1]);
        while (!isS()) {
            await checkStop();
            for (let i = array.length-1; i > 0; i--) {
                const j = Math.floor(Math.random()*(i+1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            render();
        }
    }

    async function miracleSort() {
        while (!array.every((v, i) => i === 0 || v >= array[i-1])) {
            await checkStop();
            render();
        }
    }

    function updateInfo() {
        const a = document.getElementById('algoSelect').value;
        document.getElementById('logicText').innerText = info[a].logic;
        document.getElementById('complexityText').innerText = info[a].comp;
    }

    updateInfo();
    resetAll();
</script>
</body>
</html>
