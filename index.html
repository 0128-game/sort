<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>The Complete Sorting Encyclopedia</title>
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; --card: #ffffff; --text: #0f172a; }
        body { font-family: 'Helvetica Neue', Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 95vw; max-width: 1100px; }
        .controls { background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
        .graph-container { background: #1e293b; height: 300px; border-radius: 8px; display: flex; align-items: flex-end; padding: 10px; gap: 1px; margin-bottom: 20px; }
        .bar { background: #38bdf8; flex: 1; transition: height 0.1s; }
        .bar.comparing { background: #ef4444; }
        .bar.writing { background: #fbbf24; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 15px; }
        .stat-card { background: var(--card); padding: 15px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); border-top: 4px solid var(--primary); }
        .label { font-size: 0.75rem; color: #64748b; font-weight: bold; text-transform: uppercase; margin-bottom: 5px; }
        .value { font-size: 0.9rem; line-height: 1.5; font-weight: 500; }
        select, input, button { padding: 10px; border-radius: 6px; border: 1px solid #cbd5e1; font-size: 0.9rem; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        button:hover { background: #1d4ed8; }
        h2 { margin: 0 0 15px 0; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <h2>ã‚½ãƒ¼ãƒˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ç©¶æ¥µå›³é‘‘</h2>

    <div class="controls">
        <div>
            <div class="label">ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </div>
            <select id="algoSelect" style="width: 100%;" onchange="updateInfo()">
                <optgroup label="ğŸš€ å¤§è¦æ¨¡å‘ã (é«˜é€Ÿ)">
                    <option value="quick">ã‚¯ã‚¤ãƒƒã‚¯ã‚½ãƒ¼ãƒˆ</option>
                    <option value="merge">ãƒãƒ¼ã‚¸ã‚½ãƒ¼ãƒˆ</option>
                    <option value="heap">ãƒ’ãƒ¼ãƒ—ã‚½ãƒ¼ãƒˆ</option>
                    <option value="tim">ãƒ†ã‚£ãƒ ã‚½ãƒ¼ãƒˆ</option>
                    <option value="counting">è¨ˆæ•°ã‚½ãƒ¼ãƒˆ (ç‰¹å®šæ¡ä»¶ä¸‹)</option>
                </optgroup>
                <optgroup label="ğŸ“Š ä¸­è¦æ¨¡å‘ã">
                    <option value="shell">ã‚·ã‚§ãƒ«ã‚½ãƒ¼ãƒˆ</option>
                    <option value="cocktail">ã‚«ã‚¯ãƒ†ãƒ«ã‚½ãƒ¼ãƒˆ</option>
                </optgroup>
                <optgroup label="ğŸ” å°è¦æ¨¡å‘ã (åŸºæœ¬)">
                    <option value="insertion">æŒ¿å…¥ã‚½ãƒ¼ãƒˆ</option>
                    <option value="selection">é¸æŠã‚½ãƒ¼ãƒˆ</option>
                    <option value="bubble">ãƒãƒ–ãƒ«ã‚½ãƒ¼ãƒˆ</option>
                    <option value="gnome">ãƒãƒ¼ãƒ ã‚½ãƒ¼ãƒˆ</option>
                </optgroup>
                <optgroup label="ğŸ¤¡ ãƒã‚¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³">
                    <option value="abe">ã‚¢ãƒ™ã‚½ãƒ¼ãƒˆ</option>
                    <option value="stalin">ã‚¹ã‚¿ãƒ¼ãƒªãƒ³ã‚½ãƒ¼ãƒˆ</option>
                    <option value="sleep">ã‚¹ãƒªãƒ¼ãƒ—ã‚½ãƒ¼ãƒˆ</option>
                    <option value="bogo">ãƒœã‚´ã‚½ãƒ¼ãƒˆ</option>
                    <option value="miracle">ãƒŸãƒ©ã‚¯ãƒ«ã‚½ãƒ¼ãƒˆ</option>
                    <option value="id">ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãƒ‡ã‚¶ã‚¤ãƒ³</option>
                </optgroup>
            </select>
        </div>
        <div>
            <div class="label">ãƒ‡ãƒ¼ã‚¿æ•° (5ã€œ300)</div>
            <input type="number" id="dataCount" value="60" min="5" max="300" style="width: 80%;">
        </div>
        <div style="display: flex; align-items: flex-end; gap: 10px;">
            <button onclick="initArray()" style="background: #64748b;">ãƒªã‚»ãƒƒãƒˆ</button>
            <button onclick="startSort()">ã‚½ãƒ¼ãƒˆé–‹å§‹</button>
        </div>
    </div>

    <div class="graph-container" id="graph"></div>

    <div class="stats-grid">
        <div class="stat-card"><div class="label">ä»•çµ„ã¿</div><div class="value" id="logicText">-</div></div>
        <div class="stat-card"><div class="label">è¨ˆç®—æ™‚é–“ (æœ€è‰¯ / æœ€æ‚ª)</div><div class="value" id="complexityText">-</div></div>
        <div class="stat-card"><div class="label">è¨ˆæ¸¬çµæœ</div><div class="value" id="timeValue">0 ms</div></div>
    </div>
</div>

<script>
    let array = [];
    const graph = document.getElementById('graph');
    const info = {
        quick: { logic: "ãƒ”ãƒœãƒƒãƒˆã‚’åŸºæº–ã«åˆ†å‰²ã‚’ç¹°ã‚Šè¿”ã™ã€‚å¹³å‡çš„ã«æœ€é€Ÿã®å®Ÿç”¨ã‚½ãƒ¼ãƒˆã€‚", comp: "O(n log n) / O(nÂ²)" },
        merge: { logic: "æœ€å°å˜ä½ã¾ã§åˆ†å‰²ã—ã¦ã€æ•´åˆ—ã—ãªãŒã‚‰åˆä½“ã•ã›ã‚‹ã€‚å®‰å®šæ€§ãŒé«˜ã„ã€‚", comp: "O(n log n) / O(n log n)" },
        heap: { logic: "æœ¨æ§‹é€ ï¼ˆãƒ’ãƒ¼ãƒ—ï¼‰ã‚’ä½œã‚Šã€æœ€å¤§å€¤ã‹ã‚‰é †ã«å–ã‚Šå‡ºã™æ‰‹æ³•ã€‚", comp: "O(n log n) / O(n log n)" },
        tim: { logic: "æŒ¿å…¥ã‚½ãƒ¼ãƒˆã¨ãƒãƒ¼ã‚¸ã‚½ãƒ¼ãƒˆã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã€‚Pythonç­‰ã®æ¨™æº–æ¡ç”¨ã€‚", comp: "O(n) / O(n log n)" },
        counting: { logic: "å€¤ã‚’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã¨ã—ã¦å‡ºç¾å›æ•°ã‚’æ•°ãˆã‚‹ã€‚æ¯”è¼ƒã‚’è¡Œã‚ãªã„ã€‚", comp: "O(n + k) / O(n + k)" },
        shell: { logic: "é–“éš”ã‚’ç©ºã‘ã¦æŒ¿å…¥ã‚½ãƒ¼ãƒˆã‚’è¡Œã„ã€å¾ã€…ã«è©°ã‚ã‚‹æ”¹è‰¯å‹æŒ¿å…¥ã‚½ãƒ¼ãƒˆã€‚", comp: "O(n log n) / O(nÂ².Â²âµã€œ)" },
        cocktail: { logic: "ãƒãƒ–ãƒ«ã‚½ãƒ¼ãƒˆã®æ”¹è‰¯ç‰ˆã€‚å·¦å³ä¸¡æ–¹å‘ã«ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦å¾€å¾©ã™ã‚‹ã€‚", comp: "O(n) / O(nÂ²)" },
        insertion: { logic: "æœªæ•´åˆ—ã®è¦ç´ ã‚’ã€æ•´åˆ—æ¸ˆã¿ã®é©åˆ‡ãªä½ç½®ã«ã€ŒæŒ¿å…¥ã€ã™ã‚‹ã€‚", comp: "O(n) / O(nÂ²)" },
        selection: { logic: "æœ€å°å€¤ã‚’æ¢ã—ã¦å…ˆé ­ã¨å…¥ã‚Œæ›¿ãˆã‚‹ä½œæ¥­ã‚’ç¹°ã‚Šè¿”ã™ã€‚", comp: "O(nÂ²) / O(nÂ²)" },
        bubble: { logic: "éš£ã‚Šåˆã†è¦ç´ ã‚’æ¯”è¼ƒã—ã¦å…¥ã‚Œæ›¿ãˆã‚‹ã€‚æœ€ã‚‚æ•™è‚²çš„ãªã‚½ãƒ¼ãƒˆã€‚", comp: "O(n) / O(nÂ²)" },
        gnome: { logic: "å¤§å°ãŒé€†ãªã‚‰å…¥ã‚Œæ›¿ãˆã¦ä¸€æ­©æˆ»ã‚‹ã€åº­å¸«(ãƒãƒ¼ãƒ )ã®å‹•ãã€‚", comp: "O(n) / O(nÂ²)" },
        abe: { logic: "ç¾åœ¨ã®æœ€å¤§å€¤ã‚ˆã‚Šå°ã•ã„å€¤ã‚’æœ€å¤§å€¤ã¸å¼·åˆ¶ä¸Šæ›¸ã(ä¸Šæ–¹ä¿®æ­£)ã™ã‚‹ã€‚", comp: "O(n) / O(n)" },
        stalin: { logic: "é †åºã‚’ä¹±ã™è¦ç´ ã‚’é…åˆ—ã‹ã‚‰æ¶ˆå»ï¼ˆç²›æ¸…ï¼‰ã™ã‚‹ã€‚ãƒ‡ãƒ¼ã‚¿ã¯æ¸›ã‚‹ã€‚", comp: "O(n) / O(n)" },
        sleep: { logic: "æ•°å€¤ã«å¿œã˜ãŸç§’æ•°å¾…æ©Ÿã—ã¦å‡ºåŠ›ã€‚å¾…ã¤ã ã‘ã§ä¸¦ã³å¤‰ã‚ã‚‹ã€‚", comp: "O(n + max) / O(n + max)" },
        bogo: { logic: "æƒã†ã¾ã§ãƒ©ãƒ³ãƒ€ãƒ ã«ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ç¶šã‘ã‚‹ã€çµ¶æœ›ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã€‚", comp: "O(n) / âˆ" },
        miracle: { logic: "å®‡å®™ç·šãªã©ã§ãƒ¡ãƒ¢ãƒªãŒæ›¸ãæ›ã‚ã‚Šã€å¥‡è·¡çš„ã«æƒã†ã®ã‚’å¾…ã¤ã€‚", comp: "O(n) / âˆ" },
        id: { logic: "ã€Œå‰µé€ ä¸»ãŒæ„å›³ã—ãŸé †åºã§ã‚ã‚‹ã€ã¨ã—ã¦ã€ä½•ã‚‚ã—ãªã„å“²å­¦ã€‚ç¬æ™‚ã«çµ‚äº†ã€‚", comp: "O(0) / O(0)" }
    };

    function initArray() {
        const count = parseInt(document.getElementById('dataCount').value);
        array = Array.from({length: count}, () => Math.floor(Math.random() * 90) + 10);
        render();
        document.getElementById('timeValue').innerText = "0 ms";
    }

    function render(hl = [], type = 'comparing') {
        graph.innerHTML = '';
        array.forEach((v, i) => {
            const b = document.createElement('div');
            b.className = 'bar';
            b.style.height = `${v}%`;
            if (hl.includes(i)) b.classList.add(type);
            graph.appendChild(b);
        });
    }

    function updateInfo() {
        const a = document.getElementById('algoSelect').value;
        document.getElementById('logicText').innerText = info[a].logic;
        document.getElementById('complexityText').innerText = info[a].comp;
    }

    const sleep = (ms) => new Promise(r => setTimeout(r, ms));

    async function startSort() {
        const a = document.getElementById('algoSelect').value;
        const start = performance.now();
        
        if (a === 'quick') await quickSort(0, array.length - 1);
        else if (a === 'merge') await mergeSort(0, array.length - 1);
        else if (a === 'heap') await heapSort();
        else if (a === 'tim') await timSort();
        else if (a === 'counting') await countingSort();
        else if (a === 'shell') await shellSort();
        else if (a === 'cocktail') await cocktailSort();
        else if (a === 'insertion') await insertionSort();
        else if (a === 'selection') await selectionSort();
        else if (a === 'bubble') await bubbleSort();
        else if (a === 'gnome') await gnomeSort();
        else if (a === 'abe') await abeSort();
        else if (a === 'stalin') await stalinSort();
        else if (a === 'sleep') await sleepSort();
        else if (a === 'bogo') await bogoSort();
        else if (a === 'miracle') await miracleSort();
        else if (a === 'id') alert("å‰µé€ ä¸»ã®æ„å›³ã«ã‚ˆã‚Šæ•´åˆ—æ¸ˆã¿ã¨èªã‚ã‚‰ã‚Œã¾ã—ãŸã€‚");

        document.getElementById('timeValue').innerText = `${(performance.now() - start).toFixed(2)} ms`;
        render();
    }

    // --- å„ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®å®Ÿè£… (ä»£è¡¨çš„ãªã‚‚ã®) ---
    async function quickSort(s, e) {
        if (s >= e) return;
        let p = array[e], i = s;
        for (let j = s; j < e; j++) {
            if (array[j] < p) { [array[i], array[j]] = [array[j], array[i]]; i++; render([i, j]); await sleep(15); }
        }
        [array[i], array[e]] = [array[e], array[i]];
        await quickSort(s, i - 1); await quickSort(i + 1, e);
    }

    async function mergeSort(s, e) {
        if (s >= e) return;
        let m = Math.floor((s + e) / 2);
        await mergeSort(s, m); await mergeSort(m + 1, e);
        let left = array.slice(s, m + 1), right = array.slice(m + 1, e + 1);
        let i = 0, j = 0, k = s;
        while (i < left.length && j < right.length) {
            if (left[i] <= right[j]) array[k++] = left[i++];
            else array[k++] = right[j++];
            render([k]); await sleep(15);
        }
        while (i < left.length) array[k++] = left[i++];
        while (j < right.length) array[k++] = right[j++];
    }

    async function heapSort() {
        let n = array.length;
        const heapify = async (n, i) => {
            let largest = i, l = 2*i+1, r = 2*i+2;
            if (l < n && array[l] > array[largest]) largest = l;
            if (r < n && array[r] > array[largest]) largest = r;
            if (largest !== i) {
                [array[i], array[largest]] = [array[largest], array[i]];
                render([i, largest]); await sleep(15);
                await heapify(n, largest);
            }
        };
        for (let i = Math.floor(n/2)-1; i >= 0; i--) await heapify(n, i);
        for (let i = n-1; i > 0; i--) {
            [array[0], array[i]] = [array[i], array[0]]; render([i]); await sleep(15);
            await heapify(i, 0);
        }
    }

    async function shellSort() {
        for (let gap = Math.floor(array.length/2); gap > 0; gap = Math.floor(gap/2)) {
            for (let i = gap; i < array.length; i++) {
                let temp = array[i], j = i;
                while (j >= gap && array[j-gap] > temp) {
                    array[j] = array[j-gap]; j -= gap;
                    render([j], 'writing'); await sleep(10);
                }
                array[j] = temp;
            }
        }
    }

    async function countingSort() {
        let max = Math.max(...array), count = new Array(max + 1).fill(0), res = [];
        array.forEach(x => count[x]++);
        for (let i = 0; i <= max; i++) {
            while (count[i] > 0) {
                res.push(i); count[i]--;
                let d = [...res]; while(d.length < array.length) d.push(0);
                array = d; render([res.length-1], 'writing'); await sleep(20);
            }
        }
    }

    async function stalinSort() {
        let sorted = [array[0]];
        for (let i = 1; i < array.length; i++) {
            if (array[i] >= sorted[sorted.length - 1]) sorted.push(array[i]);
            let d = [...sorted]; while(d.length < array.length) d.push(0);
            array = d; render([i], 'comparing'); await sleep(40);
        }
    }

    async function abeSort() {
        let max = array[0];
        for (let i = 1; i < array.length; i++) {
            if (array[i] < max) array[i] = max; else max = array[i];
            render([i], 'writing'); await sleep(20);
        }
    }

    async function bubbleSort() {
        for (let i = 0; i < array.length; i++) {
            for (let j = 0; j < array.length - i - 1; j++) {
                if (array[j] > array[j+1]) [array[j], array[j+1]] = [array[j+1], array[j]];
                render([j, j+1]); await sleep(5);
            }
        }
    }

    async function bogoSort() {
        const isS = () => array.every((v, i) => i === 0 || v >= array[i-1]);
        while (!isS()) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            render(); await sleep(50);
        }
    }

    async function miracleSort() {
        while (!array.every((v, i) => i === 0 || v >= array[i-1])) {
            // å®‡å®™ç·šå¾…ã¡
            render(); await sleep(100);
        }
    }

    // ä»–ã®ã‚½ãƒ¼ãƒˆ(æŒ¿å…¥ã€é¸æŠã€ã‚«ã‚¯ãƒ†ãƒ«ã€ãƒãƒ¼ãƒ ã€ã‚¹ãƒªãƒ¼ãƒ—ã€ãƒ†ã‚£ãƒ ç­‰)ã‚‚å†…éƒ¨çš„ã«é€£å‹•
    async function insertionSort() {
        for (let i = 1; i < array.length; i++) {
            let key = array[i], j = i - 1;
            while (j >= 0 && array[j] > key) { array[j+1] = array[j]; j--; render([j, i], 'writing'); await sleep(10); }
            array[j+1] = key;
        }
    }
    async function selectionSort() {
        for (let i = 0; i < array.length; i++) {
            let m = i;
            for (let j = i + 1; j < array.length; j++) { if (array[j] < array[m]) m = j; render([i, j]); await sleep(5); }
            [array[i], array[m]] = [array[m], array[i]];
        }
    }
    async function cocktailSort() {
        let l = 0, r = array.length - 1;
        while (l < r) {
            for (let i = l; i < r; i++) { if (array[i] > array[i+1]) [array[i], array[i+1]] = [array[i+1], array[i]]; render([i, i+1]); await sleep(5); }
            r--;
            for (let i = r; i > l; i--) { if (array[i] < array[i-1]) [array[i], array[i-1]] = [array[i-1], array[i]]; render([i, i-1]); await sleep(5); }
            l++;
        }
    }
    async function gnomeSort() {
        let i = 0;
        while (i < array.length) {
            if (i === 0 || array[i] >= array[i-1]) i++;
            else { [array[i], array[i-1]] = [array[i-1], array[i]]; i--; render([i, i+1]); await sleep(5); }
        }
    }
    async function sleepSort() {
        let copy = [...array], res = [];
        array = new Array(copy.length).fill(0);
        copy.forEach(v => setTimeout(() => { res.push(v); array = [...res, ...new Array(copy.length - res.length).fill(0)]; render([res.length-1], 'writing'); }, v * 15));
        await sleep(Math.max(...copy) * 15 + 100);
    }
    async function timSort() {
        // ç°¡æ˜“ç‰ˆãƒ†ã‚£ãƒ ã‚½ãƒ¼ãƒˆå¯è¦–åŒ–
        let n = array.length, RUN = 16;
        for (let i = 0; i < n; i += RUN) {
            let end = Math.min(i + RUN - 1, n - 1);
            for (let j = i + 1; j <= end; j++) {
                let k = array[j], l = j - 1;
                while (l >= i && array[l] > k) { array[l+1] = array[l]; l--; render([l, j], 'writing'); await sleep(10); }
                array[l+1] = k;
            }
        }
        for (let s = RUN; s < n; s = 2 * s) {
            for (let l = 0; l < n; l += 2 * s) {
                let m = l + s - 1, r = Math.min((l + 2 * s - 1), (n - 1));
                if (m < r) {
                    let L = array.slice(l, m + 1), R = array.slice(m + 1, r + 1), i = 0, j = 0, k = l;
                    while (i < L.length && j < R.length) { array[k++] = (L[i] <= R[j]) ? L[i++] : R[j++]; render([k]); await sleep(15); }
                    while (i < L.length) array[k++] = L[i++]; while (j < R.length) array[k++] = R[j++];
                }
            }
        }
    }

    updateInfo();
    initArray();
</script>
</body>
</html>
